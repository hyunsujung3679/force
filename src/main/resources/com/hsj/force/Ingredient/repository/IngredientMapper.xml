<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hsj.force.ingredient.repository.IngredientMapper">

    <select id="selectIngredientSeq" resultType="String">
        SELECT I.INGREDIENT_SEQ
          FROM TINGREDIENTHIS I
         WHERE I.INGREDIENT_NO = #{ingredientNo}
           AND I.STORE_NO = #{storeNo}
         ORDER BY I.INGREDIENT_SEQ DESC
         LIMIT 1
    </select>

    <insert id="insertIngredientHis">
        INSERT
          INTO TINGREDIENTHIS
        (
          INGREDIENT_NO
        , INGREDIENT_SEQ
        , STORE_NO
        , IN_DE_QUANTITY
        , IN_DE_REASON_NO
        , EXPIRATION_DATE
        , INSERT_ID
        , INSERT_DATE
        , MODIFY_ID
        , MODIFY_DATE
        )
        VALUES
        (
          #{ingredientNo}
        , #{ingredientSeq}
        , #{storeNo}
        , #{inDeQuantity}
        , #{inDeReasonNo}
        , #{expirationDate}
        , #{insertId}
        , NOW()
        , #{modifyId}
        , NOW()
        )
    </insert>

    <update id="updateIngredient">
        UPDATE TINGREDIENT I
           SET I.QUANTITY = #{quantity}
             , I.MODIFY_ID = #{modifyId}
             , I.MODIFY_DATE = NOW()
         WHERE I.STORE_NO = #{storeNo}
           AND I.INGREDIENT_NO = #{ingredientNo}
    </update>
</mapper>