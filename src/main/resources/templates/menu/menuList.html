<!DOCTYPE html>
<html th:replace="fragment/commonBody :: commonLayout(~{::link}, ~{::script}, ~{::section})"
      xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <link rel="stylesheet" type="text/css" th:href="@{/css/menu/menuList.css}">
<script th:inline="javascript">

    function insertMenu() {

        const systemErrorMsg = [[#{message.system.error}]];
        const inputIngredientQuantityMsg = [[#{message.input.ingredient.quantity}]];
        const inputMenuNameMsg = [[#{message.input.menu.name}]];
        const inputPriceMsg = [[#{message.input.price}]];
        const inputPriceNumberMsg = [[#{message.input.price_number}]];

        const menuName = $("input[name=menu-name]").val();
        const categoryNo = $("select[name=category]").val();
        const saleStatusNo = $("select[name=sale-status]").val();
        const salePrice = $("input[name=sale-price]").val();
        const quantity = $("input[name=quantity]");
        const ingredientNo = $("select[name=ingredient]");

        if(menuName === "") {
            $(".field-error-1").text(inputMenuNameMsg);
            return;
        }

        if(salePrice === "") {
            $(".field-error-1").text(inputPriceMsg);
            return;
        }

        let quantityArr = new Array(quantity.length);
        let ingredientNoArr = new Array(ingredientNo.length);
        for(let i = 0; i < quantity.length; i++) {
            if(quantity.eq(i).val() === '') {
                $(".field-error-1").text(inputIngredientQuantityMsg);
                return;
            }
            quantityArr[i] = quantity.eq(i).val();
            ingredientNoArr[i] = ingredientNo.eq(i).val();
        }

        const parameter = {menuName : menuName,
                           categoryNo : categoryNo,
                           saleStatusNo : saleStatusNo,
                           salePrice : salePrice,
                           quantityArr : quantityArr,
                           ingredientNoArr : ingredientNoArr};

        $.ajax({
            url: "/menu/insert",
            type: "post",
            data: JSON.stringify(parameter),
            dataType : "json",
            contentType: "application/json",
            success: function(data) {
                if(data === 0) {
                    $(".field-error-1").text(systemErrorMsg);
                } else if(data === -1) {
                    $(".field-error-1").text(inputMenuNameMsg);
                } else if(data === -2) {
                    $(".field-error-1").text(inputPriceMsg);
                } else if(data === -3) {
                    $(".field-error-1").text(inputIngredientQuantityMsg);
                } else if(data === -4) {
                    $(".field-error-1").text(inputPriceNumberMsg);
                } else if(data > 0) {
                    $("#menu-add-modal-2").modal({});
                }
            },
            error: function(xhr) {
                console.log(xhr);
            }
        });
    }

    $(function() {
        const salePrice = document.querySelector('#sale-price');

        salePrice.addEventListener('keyup', function(e) {
            let value = e.target.value;
            value = Number(value.replaceAll(',', ''));
            if(isNaN(value)) {         //NaN인지 판별
                salePrice.value = 0;
            }else {                   //NaN이 아닌 경우
                const formatValue = value.toLocaleString('ko-KR');
                salePrice.value = formatValue;
            }
        })
    })

</script>
</head>
<body>

<section>
    <div class="menu-box">
        <div class="menu-title">
            <div class="menu-title-no" th:text="#{label.no}"></div>
            <div class="menu-title-name"  th:text="#{label.menu.name}"></div>
            <div class="menu-title-status"  th:text="#{label.sale.status}"></div>
            <div class="menu-title-category"  th:text="#{label.category}"></div>
            <div class="menu-title-stock"  th:text="#{label.sale.able.stock}"></div>
            <div class="menu-title-price"  th:text="#{label.price}"></div>
        </div>
        <div class="menu-content" th:each="menu : ${menuList}">
            <input type="hidden" name="menu-no" th:value="${menu.menuNo}">
            <div class="menu-no" th:text="${menu.no}"></div>
            <div class="menu-name" th:text="${menu.menuName}"></div>
            <div class="menu-status" th:text="${menu.saleStatus}"></div>
            <div class="menu-category" th:text="${menu.categoryName}"></div>
            <div class="menu-stock" th:text="${menu.stock}"></div>
            <div class="menu-price" th:text="${#numbers.formatInteger(menu.salePrice, 0, 'COMMA')}"></div>
        </div>
    </div>

    <div class="menu-button-wrap">
        <button type="button" class="menu-button-1" th:onclick="|location.href='@{menu/insert}'|" th:text="#{button.insert}"></button>
    </div>
</section>

</body>
</html>